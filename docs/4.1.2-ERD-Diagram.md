# 4.1.2 Entity Relationship Diagram (ERD)
## AI-Powered Mobile Marketplace System

---

## ERD Diagram

```
┌─────────────────────────┐
│       USER              │
├─────────────────────────┤
│ PK user_id              │
│    email                │
│    password_hash        │
│    full_name            │
│    phone_number         │
│    address              │
│    user_type            │
│    auth_token           │
│    created_at           │
│    updated_at           │
│    last_login           │
│    is_verified          │
└─────────────────────────┘
          │
          │ 1
          │
          │
          ├──────────────────────────────────────┐
          │                                      │
          │ *                                    │ *
┌─────────────────────────┐         ┌─────────────────────────┐
│      CUSTOMER           │         │       SELLER            │
├─────────────────────────┤         ├─────────────────────────┤
│ PK customer_id (FK)     │         │ PK seller_id (FK)       │
│    preferences          │         │    business_name        │
│    wishlist             │         │    business_license     │
│    loyalty_points       │         │    verification_status  │
└─────────────────────────┘         │    rating               │
          │                         │    total_sales          │
          │ 1                       │    bank_account         │
          │                         └─────────────────────────┘
          │                                    │
          │ *                                  │ 1
          │                                    │
┌─────────────────────────┐                   │ *
│       ORDER             │         ┌─────────────────────────┐
├─────────────────────────┤         │      PRODUCT            │
│ PK order_id             │         ├─────────────────────────┤
│ FK customer_id          │         │ PK product_id           │
│ FK seller_id            │         │ FK seller_id            │
│    order_date           │         │ FK category_id          │
│    total_amount         │         │    product_name         │
│    order_status         │         │    description          │
│    shipping_address     │         │    price                │
│    tracking_number      │         │    stock_quantity       │
│    payment_status       │         │    ai_score             │
└─────────────────────────┘         │    specifications       │
          │                         │    image_urls           │
          │ 1                       │    created_at           │
          │                         │    updated_at           │
          │ *                       │    is_active            │
┌─────────────────────────┐         └─────────────────────────┘
│    ORDER_ITEM           │                   │
├─────────────────────────┤                   │ 1
│ PK order_item_id        │                   │
│ FK order_id             │◄──────────────────┤
│ FK product_id           │                   │ *
│    quantity             │         ┌─────────────────────────┐
│    unit_price           │         │      REVIEW             │
│    subtotal             │         ├─────────────────────────┤
└─────────────────────────┘         │ PK review_id            │
          │                         │ FK product_id           │
          │                         │ FK customer_id          │
          │                         │    rating               │
          │                         │    review_text          │
          │ 1                       │    ai_sentiment_score   │
          │                         │    created_at           │
          │ 1                       │    is_verified          │
┌─────────────────────────┐         └─────────────────────────┘
│      PAYMENT            │                   │
├─────────────────────────┤                   │
│ PK payment_id           │                   │
│ FK order_id             │         ┌─────────────────────────┐
│    payment_method       │         │   REVIEW_SUMMARY        │
│    payment_gateway_id   │         ├─────────────────────────┤
│    amount               │         │ PK summary_id           │
│    payment_date         │         │ FK product_id           │
│    payment_status       │         │    ai_summary           │
│    transaction_id       │         │    total_reviews        │
│    confirmation_code    │         │    average_rating       │
└─────────────────────────┘         │    sentiment_breakdown  │
          │                         │    generated_at         │
          │                         └─────────────────────────┘
          │ 1
          │
          │ 1
┌─────────────────────────┐
│   TRANSACTION_LOG       │
├─────────────────────────┤
│ PK log_id               │
│ FK payment_id           │
│ FK order_id             │
│    transaction_type     │
│    amount               │
│    timestamp            │
│    status               │
│    fraud_score          │
│    ip_address           │
│    device_info          │
└─────────────────────────┘


┌─────────────────────────┐         ┌─────────────────────────┐
│      CATEGORY           │         │   AI_RECOMMENDATION     │
├─────────────────────────┤         ├─────────────────────────┤
│ PK category_id          │         │ PK recommendation_id    │
│    category_name        │         │ FK customer_id          │
│    description          │         │ FK product_id           │
│    parent_category_id   │         │    ai_model_version     │
│    is_active            │         │    recommendation_score │
└─────────────────────────┘         │    reason               │
                                    │    created_at           │
                                    └─────────────────────────┘


┌─────────────────────────┐         ┌─────────────────────────┐
│   FRAUD_DETECTION       │         │    CHATBOT_LOG          │
├─────────────────────────┤         ├─────────────────────────┤
│ PK fraud_id             │         │ PK chat_id              │
│ FK seller_id            │         │ FK customer_id          │
│    check_type           │         │    query                │
│    fraud_score          │         │    response             │
│    status               │         │    nlp_intent           │
│    checked_at           │         │    timestamp            │
│    notes                │         │    session_id           │
└─────────────────────────┘         └─────────────────────────┘


┌─────────────────────────┐
│   EXTERNAL_DATA         │
├─────────────────────────┤
│ PK external_data_id     │
│ FK product_id           │
│    data_source          │
│    data_type            │
│    data_value           │
│    last_updated         │
│    is_validated         │
└─────────────────────────┘
```

---

## Relationships Summary

### **One-to-Many Relationships**

1. **USER → CUSTOMER** (1:1 for customer type users)
   - One user can be a customer

2. **USER → SELLER** (1:1 for seller type users)
   - One user can be a seller

3. **SELLER → PRODUCT** (1:*)
   - One seller can have many products
   - Each product belongs to one seller

4. **CUSTOMER → ORDER** (1:*)
   - One customer can place many orders
   - Each order belongs to one customer

5. **SELLER → ORDER** (1:*)
   - One seller can receive many orders
   - Each order is fulfilled by one seller

6. **ORDER → ORDER_ITEM** (1:*)
   - One order can contain many order items
   - Each order item belongs to one order

7. **PRODUCT → ORDER_ITEM** (1:*)
   - One product can be in many order items
   - Each order item references one product

8. **ORDER → PAYMENT** (1:1)
   - One order has one payment
   - Each payment is for one order

9. **PAYMENT → TRANSACTION_LOG** (1:*)
   - One payment can have multiple transaction logs
   - Each transaction log belongs to one payment

10. **PRODUCT → REVIEW** (1:*)
    - One product can have many reviews
    - Each review is for one product

11. **CUSTOMER → REVIEW** (1:*)
    - One customer can write many reviews
    - Each review is written by one customer

12. **PRODUCT → REVIEW_SUMMARY** (1:1)
    - One product has one AI-generated review summary
    - Each summary is for one product

13. **CATEGORY → PRODUCT** (1:*)
    - One category can have many products
    - Each product belongs to one category

14. **CUSTOMER → AI_RECOMMENDATION** (1:*)
    - One customer can receive many AI recommendations
    - Each recommendation is for one customer

15. **PRODUCT → AI_RECOMMENDATION** (1:*)
    - One product can be recommended multiple times
    - Each recommendation is for one product

16. **SELLER → FRAUD_DETECTION** (1:*)
    - One seller can have multiple fraud checks
    - Each fraud check is for one seller

17. **CUSTOMER → CHATBOT_LOG** (1:*)
    - One customer can have many chatbot interactions
    - Each chatbot log belongs to one customer

18. **PRODUCT → EXTERNAL_DATA** (1:*)
    - One product can have multiple external data entries
    - Each external data entry is for one product

---

## Key Cardinality Notations

- **1** : One
- **\*** : Many
- **PK** : Primary Key
- **FK** : Foreign Key

---

## Entity Descriptions

### **Core Entities**

1. **USER**: Base entity for all system users (customers and sellers)
2. **CUSTOMER**: Extended user entity for buyers
3. **SELLER**: Extended user entity for product vendors
4. **PRODUCT**: Items listed for sale in the marketplace
5. **ORDER**: Purchase transactions initiated by customers
6. **ORDER_ITEM**: Individual products within an order

### **Transaction Entities**

7. **PAYMENT**: Payment information for orders
8. **TRANSACTION_LOG**: Detailed logs of all financial transactions

### **Review & Feedback Entities**

9. **REVIEW**: Customer reviews for products
10. **REVIEW_SUMMARY**: AI-generated summaries of product reviews

### **Support Entities**

11. **CATEGORY**: Product categorization
12. **AI_RECOMMENDATION**: AI-generated product recommendations
13. **FRAUD_DETECTION**: Seller verification and fraud checks
14. **CHATBOT_LOG**: NLP chatbot interaction logs
15. **EXTERNAL_DATA**: External data integration for products

---

## Database Design Notes

- **User Type Inheritance**: USER entity uses single-table inheritance with `user_type` discriminator
- **Soft Deletes**: `is_active` flags allow logical deletion
- **Audit Trails**: `created_at` and `updated_at` timestamps on major entities
- **AI Integration**: Fields like `ai_score`, `ai_sentiment_score`, `fraud_score` store AI-generated metrics
- **Normalization**: 3NF compliance with separate tables for reviews, summaries, and recommendations
- **Scalability**: Separate transaction logs for audit and analytics

---

*This ERD represents the complete data structure for the AI-Powered Mobile Marketplace system based on the DFD analysis.*
